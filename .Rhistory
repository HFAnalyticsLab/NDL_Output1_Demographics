select(.,Patient.Count) %>% mutate(.,Patient.Count=as.numeric(Patient.Count)) %>% sum(.,na.rm=TRUE)
pct_shielding_nwl <- pop_shielding_nwl_opendata/pop_nwl*100
#Leeds
pop_leeds <- pop_by_CCG %>% filter(., `CCG Name` %in% c("NHS Leeds CCG")) %>%
select(.,`All Ages`) %>% sum(.,na.rm=TRUE)
pop_shielding_leeds_opendata <- SPL_by_CCG %>% filter(.,Breakdown.Field=="ALL"&(CCG.Name %in% "NHS Leeds CCG")) %>%
select(.,Patient.Count) %>% mutate(.,Patient.Count=as.numeric(Patient.Count)) %>% sum(.,na.rm=TRUE)
pct_shielding_leeds <- pop_shielding_leeds_opendata/pop_leeds*100
#Chart data
rate_by_partner_chart_data <- rbind.data.frame(
c("Liverpool-Wirral",pct_shielding_liverpool_wirral_opendata,pop_shielding_liverpool_wirral_opendata,pop_liverpool_wirral),
c("North West England",filter(SPL_by_GOR_wEng,RGN19NM=="North West")$Shielders_pct,sum(filter(SPL_by_LA_All,RGN19NM=="North West")$Patient.Count),filter(pop_by_LA,LAD19NM=="NORTH WEST")$pop19),
c("England",filter(SPL_by_GOR_wEng,RGN19NM=="England")$Shielders_pct,filter(SPL_by_LA_All_incl_ENG,LA.Name=="ENGLAND")$Patient.Count,filter(pop_by_LA,LAD19NM=="ENGLAND")$pop19),
c("Grampian",pct_shielding_grampian_NDL,pop_shielding_grampian_NDL,pop_grampian),
c("Scotland",filter(SPL_by_GOR_wEng,RGN19NM=="Scotland")$Shielders_pct,179997,filter(pop_by_LA,LAD19NM=="SCOTLAND")$pop19),
c("Wales",pct_wales,filter(SPL_by_LA_Wales_All,LA.Name=="Wales")$Patient.Count,pop_wales),
c("North West London",pct_shielding_nwl,pop_shielding_nwl_opendata,pop_nwl),
c("Leeds",pct_shielding_leeds,pop_shielding_leeds_opendata,pop_leeds)
)
names(rate_by_partner_chart_data) <- c("Location","Rate","numerator","denominator")
rate_by_partner_chart_data <- rate_by_partner_chart_data %>%
arrange(.,desc(Rate)) %>%
mutate(.,Rate=as.numeric(Rate))
#Chart
rate_by_partner_chart <- ggplot(rate_by_partner_chart_data) +
geom_bar(aes(x=reorder(Location,Rate), y = round(Rate,1)),
fill = "firebrick",stat='identity') +
geom_text(aes(x = Location, y = Rate + 0.3,
label = paste0(round(Rate, 1),"%")),
size=2) +
theme(axis.title.x = element_blank(),
panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.x=element_text(angle=45, hjust=1),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
panel.background = element_blank(),
text = element_text(size = 7)) +
labs(title="% residents shielding",y = " ",x="")
ggplotly(rate_by_partner_chart)
age_band_chart_data <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band") %>%
filter(.,!(Breakdown_Value %in% c("90+","0-19","20-29","0-17","18-29","80-89")))
cols8 <- c(brewer.pal(n = 9, name = "Greens")[3:9],"#bdbdbd")
by_age_band_chart <- ggplot(age_band_chart_data,
aes(x=factor(Partner), y = round(rate_all,1),fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols8) +
guides(fill=guide_legend(title="Age bands"))
ggplotly(by_age_band_chart)
sex_chart_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="sex")
cols3 <- c("#66c2a5","#fc8d62","#bdbdbd")
by_sex_chart <- ggplot(sex_chart_data_full,
aes(x=factor(Partner), y = round(rate_all,1),fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=3,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols3) +
guides(fill=guide_legend(title="Sex"))
ggplotly(by_sex_chart)
reason_chart_data <- filter(allpartners.demographics.clean,Breakdown_Field=="reason_shielding") %>% filter(.,Breakdown_Value %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown"))
cols5 <- c(brewer.pal(n = 4, name = "Set1"),"#bdbdbd")
by_reason_chart <- ggplot(reason_chart_data,
aes(x=factor(Partner), y = round(rate_all,1),
fill=Breakdown_Value)) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(angle=45,hjust=1,vjust=0.5,size = 15),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols5) +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(by_reason_chart)
reason_chart_data <- filter(allpartners.demographics.clean,Breakdown_Field=="reason_shielding") %>% filter(.,Breakdown_Value %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown"))
cols5 <- brewer.pal(n = 5, name = "Set1")
by_reason_chart <- ggplot(reason_chart_data,
aes(x=factor(Breakdown_Value), y = round(rate_all,1),fill=factor(Partner))) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(angle=45,hjust=1,vjust=0.5,size = 15),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols5) +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(by_reason_chart)
reason_chart_data <- filter(allpartners.demographics.clean,Breakdown_Field=="reason_shielding")
cols5 <- brewer.pal(n = 6, name = "Set1")
by_reason_chart <- ggplot(reason_chart_data,
aes(x=factor(Breakdown_Value), y = round(rate_all,1),fill=factor(Partner))) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(angle=45,hjust=1,vjust=0.5,size = 15),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols5) +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(by_reason_chart)
urbanrural_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="urbanrural")
rural_chart <- ggplot(urbanrural_data_full,
aes(x=factor(Partner), y = round(rate_all,1),fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=4,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
guides(fill=guide_legend(title="Urban/rural"))
ggplotly(rural_chart)
deprivation_chart_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd")
cols6 <- c(brewer.pal(n = 5, name = "RdYlGn"),"#bdbdbd")
by_dep_chart <- ggplot(deprivation_chart_data_full,
aes(x=factor(Partner), y = rate_all,fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols6) +
guides(fill=guide_legend(title="Deprivation (IMD/SIMD)"))
ggplotly(by_dep_chart)
ethnicity_chart_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="ethnicity")
cols6 <- brewer.pal(n = 6, name = "Set2")
ethnicity_chart <- ggplot(ethnicity_chart_data_full,
aes(x=factor(Partner), y = round(rate_all,1),fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=2,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols6) +
guides(fill=guide_legend(title="Ethnicity"))
ggplotly(ethnicity_chart)
method_addition_data <- filter(allpartners.demographics.clean,Breakdown_Field=="shielding_list_source") %>%
filter(.,Partner!="LiverpoolWirral")
method_addition_chart <- ggplot(method_addition_data,
aes(x=factor(Partner), y = round(rate_all,1),fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=4,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
guides(fill=guide_legend(title="Method of addition"))
ggplotly(method_addition_chart)
number_conditions_data <- filter(allpartners.demographics.clean,Breakdown_Field=="number_reasons_shielding")
cols4 <- c(brewer.pal(n = 4, name = "Set3")[1:3],"#bdbdbd")
number_conditions_chart <- ggplot(number_conditions_data,
aes(x=factor(Partner), y = rate_all,fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=3,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols4) +
guides(fill=guide_legend(title="Number of conditions"))
ggplotly(number_conditions_chart)
sex_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_sex"&
var2.level!="unknown/other")
by_sex_imd_chart <- ggplot(sex_imd_data_full,
aes(x=factor(var1.level),
y = round(interaction_rate_v1,1),
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile") +
guides(fill=guide_legend(title="Sex"))
ggplotly(by_sex_imd_chart)
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+")) %>%
filter(.,!(var2.level=="unknown"&Partner=="LiverpoolWirral"))
cols8 <- brewer.pal(n = 9, name = "BuPu")[2:9]
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = round(interaction_rate_v2,1),
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile") +
scale_fill_manual(values=cols8) +
guides(fill=guide_legend(title="Age"))
ggplotly(age_imd_chart)
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
cols6 <- c(brewer.pal(n = 5, name = "RdYlGn"),"#bdbdbd")
imd_age_chart <- ggplot(age_imd_data_full,
aes(x=factor(var1.level),
y = round(interaction_rate_v1,1),
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_fill_manual(values=cols6) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
ggplotly(imd_age_chart)
reason_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease","immunosuppressants")) %>% filter(.,var1.level!="unknown")
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=factor(var1.level),
y = round(interaction_rate_v1,1),
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile")  +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(reason_imd_chart)
reason_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level!="unknown")
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=factor(var1.level),
y = round(interaction_rate_v1,1),
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile")  +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(reason_imd_chart)
reason_age_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="shielding_reason_age_band"&var2.level!="unknown"&(var1.level %in% c("respiratory","cancer","rare_disease","immunosuppressants")))
reason_age_chart <- ggplot(reason_age_data_full,
aes(x=factor(var2.level),
y = round(interaction_rate_v2,1),
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age")  +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(reason_age_chart)
reason_age_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="shielding_reason_age_band"&var1.level!="unknown"&var2.level!="unknown")
reason_age_chart <- ggplot(reason_age_data_full,
aes(x=factor(var2.level),
y = round(interaction_rate_v2,1),
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age")  +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(reason_age_chart)
reason_age_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="shielding_reason_age_band"&var2.level!="unknown"&(var1.level %in% c("respiratory","cancer","rare_disease","immunosuppressants")))
reason_age_chart <- ggplot(reason_age_data_full,
aes(x=factor(var2.level),
y = round(interaction_rate_v2,1),
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age")  +
guides(fill=guide_legend(title="Reason for shielding"))
ggplotly(reason_age_chart)
source_age_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="shielding_list_source_age_band"&var2.level!="unknown")
source_age_chart <- ggplot(source_age_data_full,
aes(x=factor(var2.level),
y = round(interaction_rate_v2,1),
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age")  +
guides(fill=guide_legend(title="Source of addition"))
ggplotly(source_age_chart)
deprivation_chart_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd")
dep_data <- deprivation_chart_data_full %>% select(.,Partner,Breakdown_Value,rate_all) %>%
spread(., Breakdown_Value, rate_all)
dep_data_known <- deprivation_chart_data_full %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known)
dep_data_known
urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_all) %>%
spread(., Breakdown_Value, rate_all) %>% t() %>% as.data.frame()
urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_all) %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_data_full
urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_known) %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_data_full <- urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_all) %>%
spread(., Breakdown_Value, rate_all) %>% t() %>% as.data.frame()
urbanrural_data_full <- cbind(rownames(urbanrural_data_full),urbanrural_data_full)
urbanrural_known_data_full <- urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_known_data_full <- cbind(rownames(urbanrural_known_data_full),urbanrural_known_data_full)
urbanrural_data_full
urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="urbanrural")
urbanrural_data_full <- urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_all) %>%
spread(., Breakdown_Value, rate_all) %>% t() %>% as.data.frame()
urbanrural_data_full <- cbind(rownames(urbanrural_data_full),urbanrural_data_full)
urbanrural_known_data_full <- urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_known_data_full <- cbind(rownames(urbanrural_known_data_full),urbanrural_known_data_full)
#Urban/Rural
urbanrural_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="urbanrural")
urbanrural_data_full <- urbanrural_data_full %>% select(.,Partner,Breakdown_Value,rate_all) %>%
spread(., Breakdown_Value, rate_all) %>% t() %>% as.data.frame()
urbanrural_data_full <- cbind(rownames(urbanrural_data_full),urbanrural_data_full)
urbanrural_known_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="urbanrural") %>%
select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known) %>% t() %>% as.data.frame()
urbanrural_known_data_full <- cbind(rownames(urbanrural_known_data_full),urbanrural_known_data_full)
urbanrural_known_data_full
filter(allpartners.demographics.clean,Breakdown_Field=="ethnicity")
ethnicity_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="ethnicity")
View(ethnicity_data_full)
ethnicity_data_full
fwrite(ethnicity_data_full, file = paste0(gitdir,"/ethnicity_data_full.csv"), sep = ",")
ethnicity_data_full
ethnicity_data_full
gitdir
sex_chart_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="sex")
cols3 <- c("#66c2a5","#fc8d62","#bdbdbd")
by_sex_chart <- ggplot(sex_chart_data_full,
aes(x=factor(Partner), y = round(rate_known,1),fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=3,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 7),
axis.text = element_text(size = 7),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
scale_fill_manual(values=cols3) +
guides(fill=guide_legend(title="Sex"))
ggplotly(by_sex_chart)
filter(allpartners.demographics.clean,Breakdown_Field=="sex")
sex_data <- filter(allpartners.demographics.clean,Breakdown_Field=="sex") %>%
filter(.,Partner!="England") %>% select(.,Partner,Breakdown_Value,rate_all,rate_known)
sex_data
filter(allpartners.demographics.clean,Breakdown_Field=="sex") %>%
filter(.,Partner!="ENGLAND") %>% select(.,Partner,Breakdown_Value,rate_all,rate_known)
age_band_chart_data <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band") %>%
filter(.,!(Breakdown_Value %in% c("90+","0-19","20-29","0-17","18-29","80-89")))
age_band_chart_data
age_band_chart_data_known <- age_band_chart_data %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known)
age_band_chart_data_known
age_band_chart_data <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band") %>%
filter(.,!(Breakdown_Value %in% c("90+","0-19","20-29","0-17","18-29","80-89")))
age_band_chart_data_known <- age_band_chart_data %>% select(.,Partner,Breakdown_Value,rate_known) %>%
filter(.,Breakdown_Value!="unknown") %>%
spread(., Breakdown_Value, rate_known) %>%
mutate(.,`70+`=`70-79`+`80+`)
age_band_chart_data_known
unique(filter(allpartners.demographics.clean,Breakdown_Field=="reason_shielding")$Breakdown_Value)
filter(allpartners.demographics.clean,Breakdown_Field=="reason_shielding") %>%
filter(.,Partner=="GrampianAberdeen"|Partner=="Wales")
filter(allpartners.demographics.clean,Breakdown_Field=="reason_shielding") %>%
filter(.,Partner=="GrampianAberdeen"|Partner=="Wales") %>%
arrange(.,Partner,-Count)
filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var2.level) %>%
spread(., var2.level, interaction_rate_v1)
filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var2.level)
filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var2.level) %>%
spread(., var2.level, interaction_rate_v1)
filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown"&Partner=="Wales") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var1.n,var2.level,var2.n)
wales_dep_reason <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown"&Partner=="Wales") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var1.n,var2.level,var2.n)
grampian_dep_reason <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown"&Partner=="GrampianAberdeen") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var1.n,var2.level,var2.n)
grampian_dep_reason
678/1226*100
reason_imd_data_full
reason_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level %in% c("respiratory","cancer","rare_disease",
"immunosuppressants","unknown")) %>%
filter(.,var1.level!="unknown") %>%
select(.,Partner,Count,interaction_rate_v1,var1.level,var2.level) %>%
spread(., var2.level, interaction_rate_v1)
reason_imd_data_full
wales_dep_reason
View(wales_dep_reason)
View(grampian_dep_reason)
