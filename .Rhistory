reason_imd_data_full
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v2,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group")  +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
reason_imd_chart
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=reorder(var1.level, -interaction_rate_v2),
y = interaction_rate_v2,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group")  +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
reason_imd_chart
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=reorder(factor(var1.level), -interaction_rate_v2),
y = interaction_rate_v2,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group")  +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
reason_imd_chart
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=reorder(var1.level, -interaction_rate_v2),
y = interaction_rate_v2,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group")  +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
reason_imd_chart
windows()
reason_imd_chart
reason_imd_data_full
windows()
reason_imd_chart
reason_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_shielding_reason") %>%
filter(.,var2.level!="unknown") %>%
select(.,Partner,Breakdown_Field,Breakdown_Value,Count,n,n_known,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2)
reason_imd_chart <- ggplot(reason_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v2,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group")  +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
reason_imd_chart
ggsave(paste0(graphsdir,"reason_imd_chart.png"), reason_imd_chart, device="png",width = 25, height = 8,dpi=600)
fwrite(reason_imd_data_full, file = paste0(graphsdir,"reason_imd_data_full.csv"), sep = ",")
reason_imd_data_full
age_imd_data_small <- select(age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known)
age_imd_data_small
age_imd_data_small <- select(age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 1))
age_imd_data_small
age_imd_data_small <- select(age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 2))
age_imd_data_small
age_imd_data_small <- select(Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 2))
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+")) %>%
age_imd_data_small <- select(Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 2))
allpartners.demographics.clean
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+")) %>%
age_imd_data_full
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_full
age_imd_data_small <- select(Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 2))
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 2))
age_imd_data_small
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 1))
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 1))
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(across(where(is.numeric), round, 2))
age_imd_data_full
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known) %>%
mutate(.,across(where(is.numeric), round, 2))
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known)
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known)
select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,
n,n_known)
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_full
age_imd_data_small <- select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 2))
select(age_imd_data_full,Partner,age_imd_data_full,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known)
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
select(age_imd_data_full,Partner,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 2))
age_imd_data_small <- select(age_imd_data_full,Partner,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 1))
fwrite(age_imd_data_small, file = paste0(graphsdir,"data for charts/age_imd_data_small.csv"), sep = ",")
ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v1,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge")
age_imd_data_full
filter(age_imd_data_full,Partner="GrampianAberdeen"&var2.level==1)
filter(age_imd_data_full,Partner="GrampianAberdeen"&var2.level=="1")
dplyr::filter(age_imd_data_full,Partner="GrampianAberdeen"&var2.level=="1")
age_imd_data_full
dplyr::filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")
sum(filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")$interaction_rate_v2)
ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="1")
sum(filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="1")$interaction_rate_v2)
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="5")
848/2907
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="5")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="1")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="5")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="1")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="5")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="1")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="5")
sex_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_sex"&
var2.level!="unknown/other")
sex_imd_data_full
sex_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_sex"&
var2.level!="unknown/other")
sex_imd_data_full
filter(age_imd_data_full,Partner=="GrampianAberdeen"&var1.level=="1")
filter(age_imd_data_full,Partner=="GrampianAberdeen"&var1.level=="1")
filter(sex_imd_data_full,Partner=="GrampianAberdeen"&var1.level=="1")
sum(filter(sex_imd_data_full,Partner=="GrampianAberdeen"&var1.level=="1")$interaction_rate_v1)
by_sex_imd_chart <- ggplot(sex_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v1,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(interaction_rate_v1,0),"%"),y=(interaction_rate_v2+2)),size=6,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile") +
guides(fill=guide_legend(title="Sex"))
windows()
by_sex_imd_chart
by_sex_imd_chart <- ggplot(sex_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v1,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(interaction_rate_v1,0),"%"),y=(interaction_rate_v1+2)),size=6,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile") +
guides(fill=guide_legend(title="Sex"))
windows()
by_sex_imd_chart
sex_imd_data_small <- select(sex_imd_data_full,Partner,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 1))
sex_imd_data_small
sex_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="imd_sex"&
var2.level!="unknown/other")
sex_imd_data_small <- select(sex_imd_data_full,Partner,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 1))
filter(sex_imd_data_full,Partner=="GrampianAberdeen"&var1.level=="1")
sum(filter(sex_imd_data_full,Partner=="GrampianAberdeen"&var1.level=="1")$interaction_rate_v1)
by_sex_imd_chart <- ggplot(sex_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v1,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(interaction_rate_v1,0),"%"),y=(interaction_rate_v1+2)),size=6,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="IMD/SIMD quintile") +
guides(fill=guide_legend(title="Sex"))
windows()
by_sex_imd_chart
#Save chart
ggsave(paste0(graphsdir,"by_sex_imd_chart.png"), by_sex_imd_chart, device="png",width = 15, height = 8,dpi=600)
fwrite(sex_imd_data_small, file = paste0(graphsdir,"data for charts/sex_imd_data_small.csv"), sep = ",")
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_small <- select(age_imd_data_full,Partner,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 1))
age_imd_data_full
filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")
filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")
sum(filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")$interaction_rate_v2)
142/1226
ggplot(age_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v2,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge")
ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge")
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols6,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
age_imd_chart
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols8,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
age_imd_chart
cols8 <- brewer.pal(n = 8, name = "BuPu")
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols8,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
age_imd_chart
brewer.pal(n = 9, name = "BuPu")
brewer.pal(n = 10, name = "BuPu")
cols8 <- brewer.pal(n = 9, name = "BuPu")[2:9]
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols8,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
age_imd_chart
ggplotly(age_imd_chart, tooltip = "text")
age_imd_chart
ggplotly(age_imd_chart)
windows()
age_imd_chart
ggplotly(age_imd_chart)
library(plotly)
ggplotly(age_imd_chart)
method_addition_data <- filter(allpartners.demographics.clean,Breakdown_Field=="shielding_list_source") %>%
filter(.,Partner=="GrampianAberdeen")
method_addition_chart <- ggplot(method_addition_data,
aes(x=factor(Partner), y = rate_all,fill=factor(Breakdown_Value))) +
geom_bar(stat="identity",position="dodge") +
geom_text(aes(label=paste0(round(rate_all,0),"%"),y=(rate_all+2)),size=6,angle = 45,hjust=0.5,vjust=0,colour="red",position = position_dodge(.9)) +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm")))  +
labs(title="%",y = " ",x="Partner") +
guides(fill=guide_legend(title="Method of addition"))
windows()
method_addition_chart
ggplotly(method_addition_chart)
windows()
age_imd_chart
ggplotly(age_imd_chart)
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=var2.level,
y = interaction_rate_v2,
fill=var1.level)) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols8,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
age_imd_chart
ggplotly(age_imd_chart)
age_imd_data_full <- filter(allpartners.demographics.clean,Breakdown_Field=="age_band_imd") %>%
filter(.,var1.level %in% c("0-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
age_imd_data_small <- select(age_imd_data_full,Partner,var1,var2,
var1.level,var2.level,rate_all,rate_known,interaction_rate_v1,interaction_rate_v2,n,n_known) %>%
mutate(.,across(where(is.numeric), round, 1))
filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")
sum(filter(age_imd_data_full,Partner=="GrampianAberdeen"&var2.level=="1")$interaction_rate_v2)
cols8 <- brewer.pal(n = 9, name = "BuPu")[2:9]
age_imd_chart <- ggplot(age_imd_data_full,
aes(x=factor(var2.level),
y = interaction_rate_v2,
fill=factor(var1.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols8,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
windows()
age_imd_chart
#Save chart
ggsave(paste0(graphsdir,"age_imd_chart.png"), age_imd_chart, device="png",width = 25, height = 8,dpi=600)
fwrite(age_imd_data_small, file = paste0(graphsdir,"data for charts/age_imd_data_small.csv"), sep = ",")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var2.level=="1")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var1.level=="80+")
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var1.level=="80+")
sum(filter(age_imd_data_full,Partner=="LiverpoolWirral"&var1.level=="80+")$interaction_rate_v2)
sum(filter(age_imd_data_full,Partner=="LiverpoolWirral"&var1.level=="80+")$interaction_rate_v1)
ggplot(age_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v1,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge")
ggplot(age_imd_data_full,
aes(x=factor(var1.level),
y = interaction_rate_v1,
fill=factor(var2.level))) +
facet_wrap(~ Partner) +
geom_bar(stat="identity",position="dodge") +
theme(panel.border = element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(),axis.text.y=element_blank(),
axis.ticks.y=element_blank(),axis.ticks.x=element_blank(),
text = element_text(size = 30),
axis.text = element_text(size = 30),
axis.title.x = element_text(margin = unit(c(3, 0, 0, 0), "mm"))) +
labs(title=" ",y = " ",x="Age group") +
scale_colour_manual(
values = cols6,
aesthetics = c("colour", "fill")) +
guides(fill=guide_legend(title="IMD/SIMD quintile"))
filter(age_imd_data_full,Partner=="LiverpoolWirral"&var1.level=="80+")
